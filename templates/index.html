<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作記錄系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .record-table { margin-top: 20px; }
        .form-container { background: #f8f9fa; padding: 20px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container py-4">
        <h1 class="text-center mb-4">工作記錄系統</h1>
        
        <!-- 消息提示 -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- 表單 -->
        <div class="form-container mb-4">
            <h3>新增工作記錄</h3>
            <form method="POST" action="/add_record">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="work_id" class="form-label">工作單號*</label>
                        <input type="text" class="form-control" id="work_id" name="work_id" required>
                    </div>
                    <div class="col-md-6">
                        <label for="work_date" class="form-label">工作日期*</label>
                        <input type="date" class="form-control" id="work_date" name="work_date" 
                               value="{{ datetime.now().strftime('%Y-%m-%d') }}" required>
                    </div>
                    <div class="col-md-4">
                        <label for="code" class="form-label">代號*</label>
                        <select class="form-select" id="code" name="code" required>
                            <option value="">選擇代號</option>
                            {% for code in codes %}
                                <option value="{{ code }}">{{ code }} ({{ CODE_PRICES[code] }}元)</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="quantity" class="form-label">數量</label>
                        <input type="number" class="form-control" id="quantity" name="quantity" value="1" min="1">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">單價</label>
                        <input type="text" class="form-control" id="price_display" readonly>
                    </div>
                    <div class="col-12">
                        <label for="content" class="form-label">工作內容</label>
                        <textarea class="form-control" id="content" name="content" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">保存記錄</button>
                        <a href="/export" class="btn btn-success ms-2">導出Excel</a>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- 記錄表格 -->
        <h3>工作記錄列表</h3>
        <div class="table-responsive record-table">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>工作單號</th>
                        <th>工作日期</th>
                        <th>代號</th>
                        <th>單價</th>
                        <th>數量</th>
                        <th>總價</th>
                        <th>工作內容</th>
                        <th>記錄時間</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                    <tr>
                        <td>{{ record['工作單號'] }}</td>
                        <td>{{ record['工作日期'] }}</td>
                        <td>{{ record['代號'] }}</td>
                        <td>{{ record['單價'] }}</td>
                        <td>{{ record['數量'] }}</td>
                        <td>{{ record['總價'] }}</td>
                        <td>{{ record['工作內容'] }}</td>
                        <td>{{ record['記錄時間'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 根據選擇的代號顯示單價
        document.getElementById('code').addEventListener('change', function() {
            const code = this.value;
            const prices = {
                {% for code, price in CODE_PRICES.items() %}
                    '{{ code }}': {{ price }},
                {% endfor %}
            };
            document.getElementById('price_display').value = prices[code] || '0';
        });
    </script>
</body>
</html>